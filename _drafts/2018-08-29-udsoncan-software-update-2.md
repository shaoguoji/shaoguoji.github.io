---
layout:          post
title:           CAN 诊断升级那点事儿（一） 
subtitle:        嵌入式软件更新方法，IAP 方式烧录的实现
date:            2018-08-29 22:26:39 +0800
author:          Shao Guoji
header-img:      
catalog:         true
tag:
    - 嵌入式
    - 汽车电子
---

#### 数据链路与表示协议

关于 IAP 的实现灵活性，下面请容许我对“数据链路与表示协议”两个词语偷换概念，谈谈个人的拙见，希望建立更抽象统一的思维模型，这将有助于理解不同的 IAP 升级方式。

在计算机中，所有数据处理的起点都是单个二进制位，并通过位操作得到一个字节、进行下一步操作。如果把“拿到一个字节”这个动作看做分界，对数据处理流程进行分层，下层我把它称为“数据链路”，上层称为“表示协议”。

![图1 数据分层示意图]()

如上图所示，数据从物理层的电平、经过不同数据链路后得到字节，然后根据协议解析得到原始数据，如果需要发送数据，则是对应的逆过程。其中，数据链路可以是 UART、I2C、SPI、等较底层的通讯协议接口（与物理硬件联系），也可以是更高级的 TCP、UDP、CAN 等带传输控制的协议。总之，对程序而言只是从这些“管道”中获取字节数据。

而图中的表示协议，则是对获取到的字节数据进一步的表示、包装，赋以字节更多含义。UDS 就是其中的一种协议。在简单的升级流程中，甚至不需要对数据进一步表示 —— 从链路拿到的就是原始数据，直接写入 Flash 即可，因此这部分可以省略（绝大多数情况）。




